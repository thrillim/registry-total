generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// This database is to store the data of Register Department which manage 
// + All the cars, their specifications, owner, and the car's register status
// + All regeistry centers, their info, and their accounts
// + All the car's register status, updated by the registry centers
// + The accounts of Department's admins and registry centers' admins

model Car {
  ownerId                 String
  bienSo                  String         @unique
  caiTao                  Boolean
  camera                  Boolean
  carId                   Int            @id @default(autoincrement())
  chieuDaiCoSo            Int
  congSuatLonNhat         Int?
  congThucBanhXe          String
  dayMaSoQuanLy           String
  ghiChu                  String?
  khoiLuongBanThan        Int
  khoiLuongHangCc         Int?
  khoiLuongKeoTheo        String?
  khoiLuongToanBo         String?
  khongCapTemKiemDinh     Boolean
  kichThuocBao            String
  kinhDoanh               Boolean
  ktKhoangHanhLyLonNhat   Int?
  loai                    String
  lopTruc                 String?
  namSx                   Int
  nhanHieu                String
  nhienLieu               String?
  nienHanSd               Int?
  nuocSx                  String
  seri                    String?
  soKhung                 String
  soLoai                  String
  soMay                   String
  soNguoi                 String?
  soQuanLy                String
  theTichLamViecCuaDongCo Int?
  thietBiGiamSatHanhTrinh Boolean
  tocDoQuay               Int?
  vetBanhXe               String
  owner                   Owner          @relation(fields: [ownerId], references: [ownerId])
  RegistStatus            RegistStatus[]

  @@index([ownerId], map: "Car_ownerId_fkey")
}

model Owner {
  ownerAddress String
  ownerEmail   String
  ownerId      String @id
  ownerName    String
  ownerPhone   String
  ownerType    String
  ownerCars    Car[]
}

model RegistCenter {
  centerId      String         @id
  centerName    String
  centerHotline String
  centerAddress String
  centerEmail   String
  centerManager String
  centerCode    String
  Account       Account[]
  RegistStatus  RegistStatus[]
}

model RegistStatus {
  statusId         Int          @id @default(autoincrement())
  RegistCenterId   String
  carId            Int
  status           String
  statusCreatedAt  DateTime     @default(now())
  statusUpdatedAt  DateTime     @updatedAt
  statusNote       String?
  statusValidUntil DateTime?
  RegistCenter     RegistCenter @relation(fields: [RegistCenterId], references: [centerId])
  statusCar        Car          @relation(fields: [carId], references: [carId])

  @@index([RegistCenterId], map: "RegistStatus_RegistCenterId_fkey")
  @@index([carId], map: "RegistStatus_carId_fkey")
}

model Account {
  RegistCenterId       String
  accId                Int          @id @default(autoincrement())
  accPassword          String
  accRole              String
  accStatus            String       @default("unverified")
  accUsername          String       @unique
  accVerifiedAt        DateTime?
  accVerifiedByAccount Int?
  RegistCenter         RegistCenter @relation(fields: [RegistCenterId], references: [centerId])

  @@index([RegistCenterId], map: "Account_RegistCenterId_fkey")
}

// + Manage valid period (months) of the car's register status follow the law effective date and the car's type
// Cũ: 01 tháng 10 năm 2021
// Mới: 22 tháng 3 năm 2023
// Các Giấy chứng nhận kiểm định và Tem kiểm định đã được cấp trước ngày Thông tư này có hiệu lực thì tiếp tục được sử dụng đến hết thời hạn ghi trong Giấy chứng nhận kiểm định và Tem kiểm định.
// periodNameCode format: <seat/special_car><commercial><year_from_produce/renovation>
// seat/special_car: to9, over9, special
// commercial: com, nocom
// year_from_produce/renovation: to5, to7, over7to20, over20, reno
model ValidPeriod {
  periodId               Int      @id @default(autoincrement())
  periodNameCode         String
  periodName             String?
  periodLawEffectiveDate DateTime @db.Date
  firstPeriod            Int
  fromSecondPeriod       Int
}
